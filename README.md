# –ü—Ä–æ–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞: –û–Ω–ª–∞–π–Ω-–º–∞–≥–∞–∑–∏–Ω "–ú–æ–±–∏–ª—å–Ω—ã–π –º–∏—Ä"

–ü—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —ç–≤–æ–ª—é—Ü–∏—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –æ—Ç –ø—Ä–æ—Å—Ç–æ–≥–æ MongoDB –∏–Ω—Å—Ç–∞–Ω—Å–∞ –¥–æ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞ —Å —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º, —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–µ–π, –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º, API Gateway –∏ CDN.

---

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è

### –ó–∞–¥–∞–Ω–∏—è 1-6: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Å—Ö–µ–º—ã

- ‚úÖ **–ó–∞–¥–∞–Ω–∏–µ 1:** 5 —Å—Ö–µ–º —ç–≤–æ–ª—é—Ü–∏–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (`.drawio`)
- ‚úÖ **–ó–∞–¥–∞–Ω–∏–µ 2:** MongoDB —Å —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º (2 —à–∞—Ä–¥–∞)
- ‚úÖ **–ó–∞–¥–∞–Ω–∏–µ 3:** –†–µ–ø–ª–∏–∫–∞—Ü–∏—è (3 —Ä–µ–ø–ª–∏–∫–∏ –Ω–∞ —à–∞—Ä–¥)
- ‚úÖ **–ó–∞–¥–∞–Ω–∏–µ 4:** Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ **–ó–∞–¥–∞–Ω–∏–µ 5:** API Gateway (Nginx) + Service Discovery (Consul)
- ‚úÖ **–ó–∞–¥–∞–Ω–∏–µ 6:** CDN –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–∞—Ö

### –ó–∞–¥–∞–Ω–∏—è 7-10: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- ‚úÖ **–ó–∞–¥–∞–Ω–∏–µ 7:** –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º –∫–æ–ª–ª–µ–∫—Ü–∏–π (orders, products, carts)
- ‚úÖ **–ó–∞–¥–∞–Ω–∏–µ 8:** –í—ã—è–≤–ª–µ–Ω–∏–µ –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –≥–æ—Ä—è—á–∏—Ö —à–∞—Ä–¥–æ–≤
- ‚úÖ **–ó–∞–¥–∞–Ω–∏–µ 9:** –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á—Ç–µ–Ω–∏—è —Å —Ä–µ–ø–ª–∏–∫ –∏ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
- ‚úÖ **–ó–∞–¥–∞–Ω–∏–µ 10:** –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ Cassandra

üìÑ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `ARCHITECTURAL_DOCUMENT.md` (58 KB)

---

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å (–ó–∞–¥–∞–Ω–∏–µ 4: –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ)

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker Desktop (–º–∏–Ω–∏–º—É–º 2 CPU, 4 GB RAM)
- Git Bash (–¥–ª—è Windows) –∏–ª–∏ bash (–¥–ª—è Linux/Mac)

### –®–∞–≥ 1: –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

```bash
cd task4
docker compose up -d
```

### –®–∞–≥ 2: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞

–í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:

```bash
./scripts/init-cluster.sh
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –ù–∞—Å—Ç—Ä–æ–∏—Ç Config Server Replica Set
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç Replica Sets –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞—Ä–¥–∞
3. –î–æ–±–∞–≤–∏—Ç —à–∞—Ä–¥—ã –≤ –∫–ª–∞—Å—Ç–µ—Ä
4. –í–∫–ª—é—á–∏—Ç —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
5. –°–æ–∑–¥–∞—Å—Ç —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é
6. –ó–∞–ø–æ–ª–Ω–∏—Ç –¥–∞–Ω–Ω—ã–º–∏ (1000+ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://localhost:8080

–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥ (JSON):
```json
{
  "message": "Hello from pymongo-api",
  "database": "somedb",
  "collection": "helloDoc",
  "total_documents": 1000,
  "sharding_enabled": true,
  "shards": {
    "shard1": 492,
    "shard2": 508
  },
  "replicas": {
    "shard1": 3,
    "shard2": 3
  },
  "cache_enabled": true,
  "redis_url": "redis://redis:6379"
}
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
# –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å (–∏–∑ MongoDB, –º–µ–¥–ª–µ–Ω–Ω–æ ~200ms)
curl http://localhost:8080/helloDoc/users

# –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å (–∏–∑ Redis –∫–µ—à–∞, –±—ã—Å—Ç—Ä–æ <100ms)
curl http://localhost:8080/helloDoc/users
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### MongoDB: –ü—Ä–æ–≤–µ—Ä–∫–∞ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
docker compose exec -T mongos_router mongosh --quiet <<EOF
sh.status()
EOF
```

### MongoDB: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏

```bash
docker compose exec -T shard1-1 mongosh --port 27018 --quiet <<EOF
rs.status()
EOF
```

### Redis: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞

```bash
docker compose exec redis redis-cli KEYS "*"
docker compose exec redis redis-cli GET "helloDoc:users"
```

### –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

```bash
docker compose ps
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω–æ:
- 1 √ó mongos_router
- 1 √ó configSrv
- 6 √ó MongoDB (shard1-1, shard1-2, shard1-3, shard2-1, shard2-2, shard2-3)
- 1 √ó redis
- 1 √ó pymongo-api

**–ò—Ç–æ–≥–æ: 10 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤**

---

## üèóÔ∏è –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–ó–∞–¥–∞–Ω–∏–µ 5)

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å Nginx –∏ Consul:

```bash
cd task5
docker compose up -d
./scripts/init-cluster.sh
```

–î–æ—Å—Ç—É–ø–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:
- **API —á–µ—Ä–µ–∑ Nginx:** http://localhost (–ø–æ—Ä—Ç 80)
- **Consul UI:** http://localhost:8500
- **API –Ω–∞–ø—Ä—è–º—É—é:** http://localhost:8080, 8081, 8082 (3 –∏–Ω—Å—Ç–∞–Ω—Å–∞)

---

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Å—Ö–µ–º—ã

### –ö–∞–∫ –æ—Ç–∫—Ä—ã—Ç—å —Å—Ö–µ–º—ã

**–í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä–æ—Å–º–æ—Ç—Ä PNG (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Ä–µ–≤—å—é–µ—Ä–∞)**

PNG –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ GitHub Actions:
- `task1/schema1_sharding.png`
- `task1/schema2_replication.png`
- `task1/schema3_caching.png`
- `task1/schema4_api_gateway.png`
- `task1/schema5_final_with_cdn.png`

**–í–∞—Ä–∏–∞–Ω—Ç 2: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ draw.io**

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ [draw.io Desktop](https://github.com/jgraph/drawio-desktop/releases)
   –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ [https://app.diagrams.net/](https://app.diagrams.net/)
2. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª—ã `.drawio` –≤ –ø–∞–ø–∫–µ `task1/`

### –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ö–µ–º–∞ –¥–ª—è —Ä–µ–≤—å—é–µ—Ä–∞

üìÑ **–§–∞–π–ª:** `task1/schema5_final_with_cdn.drawio`

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- 3 CDN –Ω–æ–¥—ã (–ï–≤—Ä–æ–ø–∞, –ê–∑–∏—è, –°–®–ê)
- 1 API Gateway (Nginx)
- 1 Service Discovery (Consul)
- 3 API –∏–Ω—Å—Ç–∞–Ω—Å–∞ (pymongo-api)
- 1 Redis (–∫–µ—à)
- 1 Mongos Router
- 1 Config Server
- 6 MongoDB –Ω–æ–¥ (2 —à–∞—Ä–¥–∞ √ó 3 —Ä–µ–ø–ª–∏–∫–∏)

---

## üìñ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –§–∞–π–ª: `tasks7-10/ARCHITECTURAL_DOCUMENT.md`

**–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:**

1. **–ó–∞–¥–∞–Ω–∏–µ 7:** –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º –∫–æ–ª–ª–µ–∫—Ü–∏–π
   - –°—Ö–µ–º—ã –¥–ª—è `orders`, `products`, `carts`
   - –í—ã–±–æ—Ä shard-–∫–ª—é—á–µ–π (hashed vs range)
   - –ö–æ–º–∞–Ω–¥—ã MongoDB –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è

2. **–ó–∞–¥–∞–Ω–∏–µ 8:** –í—ã—è–≤–ª–µ–Ω–∏–µ –≥–æ—Ä—è—á–∏—Ö —à–∞—Ä–¥–æ–≤
   - –ú–µ—Ç—Ä–∏–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (CPU, ops/sec, data imbalance)
   - –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è
   - –ú–µ—Ö–∞–Ω–∏–∑–º—ã —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è (–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞, refine key, resharding)

3. **–ó–∞–¥–∞–Ω–∏–µ 9:** –ß—Ç–µ–Ω–∏–µ —Å —Ä–µ–ø–ª–∏–∫
   - –¢–∞–±–ª–∏—Ü–∞ –æ–ø–µ—Ä–∞—Ü–∏–π —Å –≤—ã–±–æ—Ä–æ–º Read Preference
   - –î–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏
   - –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ (PyMongo)

4. **–ó–∞–¥–∞–Ω–∏–µ 10:** –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ Cassandra
   - –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏
   - –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (partition keys, clustering keys)
   - –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ (Hinted Handoff, Read Repair, Anti-Entropy)
   - –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ (Dual-Write, Backfill, Switchover)

---

## üõ†Ô∏è –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
docker compose down
```

### –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (–≤–∫–ª—é—á–∞—è volumes)

```bash
docker compose down -v
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
docker compose logs -f pymongo-api
docker compose logs -f mongos_router
docker compose logs -f redis
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤

```bash
docker stats
```

---

1. **–û—Å–Ω–æ–≤–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:** `task4/`
   - –í–∫–ª—é—á–∞–µ—Ç –∑–∞–¥–∞–Ω–∏—è 2, 3, 4
   - –®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ + –†–µ–ø–ª–∏–∫–∞—Ü–∏—è + Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

2. **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** `task5/`
   - –í–∫–ª—é—á–∞–µ—Ç –∑–∞–¥–∞–Ω–∏—è 2, 3, 4, 5
   - + Nginx API Gateway + Consul

3. **–°—Ö–µ–º—ã:** –í—Å–µ 5 —Å—Ö–µ–º –≤ –ø–∞–ø–∫–µ `task1/`
   - –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ö–µ–º–∞: `task1/schema5_final_with_cdn.drawio`

4. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `tasks7-10/ARCHITECTURAL_DOCUMENT.md`
   - –ó–∞–¥–∞–Ω–∏—è 7-10 –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–ø–∏—Å–∞–Ω—ã

---

## üéì –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **MongoDB 7.0** ‚Äî ShardedCluster —Å Replica Sets
- **Redis 7.0** ‚Äî –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å AOF persistence
- **Nginx** ‚Äî API Gateway –∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏
- **Consul** ‚Äî Service Discovery
- **Python 3.11** ‚Äî pymongo-api (FastAPI)
- **Docker Compose** ‚Äî –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

---

## üìß –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
- `SCHEMAS_INFO.md` ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ö–µ–º –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
- `tasks7-10/ARCHITECTURAL_DOCUMENT.md` ‚Äî –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `task4/README.md` ‚Äî –¥–µ—Ç–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–ø—É—Å–∫—É

---