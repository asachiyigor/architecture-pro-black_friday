# Задание 6: CDN (Content Delivery Network)

## Описание

Задание 6 заключается в проектировании CDN для ускорения доставки статического контента пользователям в разных географических регионах.

## Схема

Схема CDN находится в **task1/schema5_final_with_cdn.drawio** (итоговая схема со всеми компонентами).

## Компоненты архитектуры с CDN

### CDN узлы (3 региона)

1. **CDN Европа** — обслуживает пользователей из Европы
2. **CDN Азия** — обслуживает пользователей из Азии
3. **CDN США** — обслуживает пользователей из США

### Пользователи

- **Пользователи Европа** → подключаются к CDN Европа
- **Пользователи Азия** → подключаются к CDN Азия
- **Пользователи США** → подключаются к CDN США

### Статический контент

CDN кеширует:
- Изображения товаров
- CSS и JavaScript файлы
- Статические HTML страницы
- Иконки и шрифты

### Взаимодействие компонентов

```
[Пользователь] → [Ближайший CDN узел]
                         ↓
           [Origin: Nginx API Gateway]
                         ↓
              [Статический контент]
```

## Преимущества CDN

1. **Снижение latency** — пользователи получают контент из ближайшего узла
2. **Снижение нагрузки** на origin сервер (Nginx)
3. **Высокая доступность** — если один узел недоступен, можно переключиться на другой
4. **Масштабируемость** — легко добавить новые региональные узлы

## Как работает CDN (сценарий)

### Первый запрос (Cache MISS)

1. Пользователь из Москвы запрашивает изображение товара
2. Запрос попадает на **CDN Европа**
3. CDN не находит файл в кеше → запрашивает у Origin (Nginx)
4. Nginx отдает файл из хранилища статического контента
5. CDN кеширует файл и отдает пользователю

### Повторные запросы (Cache HIT)

1. Другой пользователь из Берлина запрашивает то же изображение
2. Запрос попадает на **CDN Европа**
3. CDN находит файл в кеше → сразу отдает пользователю
4. Запрос к Origin не выполняется

## Примеры CDN-провайдеров

В production можно использовать:

- **Cloudflare** — глобальная CDN сеть
- **AWS CloudFront** — интеграция с AWS инфраструктурой
- **Akamai** — крупнейшая CDN в мире
- **Fastly** — высокопроизводительная CDN
- **Яндекс.Облако CDN** — российский провайдер

## Настройка TTL (Time To Live)

Для разных типов контента используются разные TTL:

| Тип контента | TTL | Причина |
|--------------|-----|---------|
| Изображения товаров | 30 дней | Редко меняются |
| CSS/JS | 7 дней | Обновляются при деплое |
| HTML страницы | 1 час | Могут содержать динамику |
| API ответы | Не кешировать | Всегда актуальные данные |

## Инвалидация кеша

При обновлении контента нужно инвалидировать кеш:

```bash
# Пример для Cloudflare API
curl -X POST "https://api.cloudflare.com/client/v4/zones/{zone_id}/purge_cache" \
  -H "Authorization: Bearer {api_token}" \
  -H "Content-Type: application/json" \
  --data '{"files":["https://example.com/images/product123.jpg"]}'
```

## Мониторинг CDN

Ключевые метрики:

- **Cache Hit Ratio** — процент запросов, обслуженных из кеша (цель: >90%)
- **Origin Requests** — количество запросов к origin серверу
- **Response Time** — время ответа CDN (цель: <50ms)
- **Bandwidth Saved** — экономия трафика на origin сервере

---

**Примечание:** Задание 6 является теоретическим и демонстрируется только на схеме `task1/schema5_final_with_cdn.drawio`. Реальная реализация CDN требует подключения облачного провайдера.

---
